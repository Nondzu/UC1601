/*
 * uc1601.c
 *
 *  Created on: 8 cze 2016
 *      Author: Kamil Nonckiewicz
 */


#include "uc1601.h"
#include <avr/pgmspace.h>


 const unsigned char font[] PROGMEM = {
   0x0, 0x0, 0x0, 0x0, 0x0,       // Ascii 0
   0x7C, 0xDA, 0xF2, 0xDA, 0x7C,  //ASC(01)
   0x7C, 0xD6, 0xF2, 0xD6, 0x7C,  //ASC(02)
   0x38, 0x7C, 0x3E, 0x7C, 0x38,
   0x18, 0x3C, 0x7E, 0x3C, 0x18,
   0x38, 0xEA, 0xBE, 0xEA, 0x38,
   0x38, 0x7A, 0xFE, 0x7A, 0x38,
   0x0, 0x18, 0x3C, 0x18, 0x0,
   0xFF, 0xE7, 0xC3, 0xE7, 0xFF,
   0x0, 0x18, 0x24, 0x18, 0x0,
   0xFF, 0xE7, 0xDB, 0xE7, 0xFF,
   0xC, 0x12, 0x5C, 0x60, 0x70,
   0x64, 0x94, 0x9E, 0x94, 0x64,
   0x2, 0xFE, 0xA0, 0xA0, 0xE0,
   0x2, 0xFE, 0xA0, 0xA4, 0xFC,
   0x5A, 0x3C, 0xE7, 0x3C, 0x5A,
   0xFE, 0x7C, 0x38, 0x38, 0x10,
   0x10, 0x38, 0x38, 0x7C, 0xFE,
   0x28, 0x44, 0xFE, 0x44, 0x28,
   0xFA, 0xFA, 0x0, 0xFA, 0xFA,
   0x60, 0x90, 0xFE, 0x80, 0xFE,
   0x0, 0x66, 0x91, 0xA9, 0x56,
   0x6, 0x6, 0x6, 0x6, 0x6,
   0x29, 0x45, 0xFF, 0x45, 0x29,
   0x10, 0x20, 0x7E, 0x20, 0x10,
   0x8, 0x4, 0x7E, 0x4, 0x8,
   0x10, 0x10, 0x54, 0x38, 0x10,
   0x10, 0x38, 0x54, 0x10, 0x10,
   0x78, 0x8, 0x8, 0x8, 0x8,
   0x30, 0x78, 0x30, 0x78, 0x30,
   0xC, 0x1C, 0x7C, 0x1C, 0xC,
   0x60, 0x70, 0x7C, 0x70, 0x60,
   0x0, 0x0, 0x0, 0x0, 0x0,
   0x0, 0x0, 0xFA, 0x0, 0x0,
   0x0, 0xE0, 0x0, 0xE0, 0x0,
   0x28, 0xFE, 0x28, 0xFE, 0x28,
   0x24, 0x54, 0xFE, 0x54, 0x48,
   0xC4, 0xC8, 0x10, 0x26, 0x46,
   0x6C, 0x92, 0x6A, 0x4, 0xA,
   0x0, 0x10, 0xE0, 0xC0, 0x0,
   0x0, 0x38, 0x44, 0x82, 0x0,
   0x0, 0x82, 0x44, 0x38, 0x0,
   0x54, 0x38, 0xFE, 0x38, 0x54,
   0x10, 0x10, 0x7C, 0x10, 0x10,
   0x0, 0x1, 0xE, 0xC, 0x0,
   0x10, 0x10, 0x10, 0x10, 0x10,
   0x0, 0x0, 0x6, 0x6, 0x0,
   0x4, 0x8, 0x10, 0x20, 0x40,
   0x7C, 0x8A, 0x92, 0xA2, 0x7C,
   0x0, 0x42, 0xFE, 0x2, 0x0,
   0x4E, 0x92, 0x92, 0x92, 0x62,
   0x84, 0x82, 0x92, 0xB2, 0xCC,
   0x18, 0x28, 0x48, 0xFE, 0x8,
   0xE4, 0xA2, 0xA2, 0xA2, 0x9C,
   0x3C, 0x52, 0x92, 0x92, 0x8C,
   0x82, 0x84, 0x88, 0x90, 0xE0,
   0x6C, 0x92, 0x92, 0x92, 0x6C,
   0x62, 0x92, 0x92, 0x94, 0x78,
   0x0, 0x0, 0x28, 0x0, 0x0,
   0x0, 0x2, 0x2C, 0x0, 0x0,
   0x0, 0x10, 0x28, 0x44, 0x82,
   0x28, 0x28, 0x28, 0x28, 0x28,
   0x0, 0x82, 0x44, 0x28, 0x10,
   0x40, 0x80, 0x9A, 0x90, 0x60,
   0x7C, 0x82, 0xBA, 0x9A, 0x72,
   0x3E, 0x48, 0x88, 0x48, 0x3E,
   0xFE, 0x92, 0x92, 0x92, 0x6C,
   0x7C, 0x82, 0x82, 0x82, 0x44,
   0xFE, 0x82, 0x82, 0x82, 0x7C,
   0xFE, 0x92, 0x92, 0x92, 0x82,
   0xFE, 0x90, 0x90, 0x90, 0x80,
   0x7C, 0x82, 0x82, 0x8A, 0xCE,
   0xFE, 0x10, 0x10, 0x10, 0xFE,
   0x0, 0x82, 0xFE, 0x82, 0x0,
   0x4, 0x2, 0x82, 0xFC, 0x80,
   0xFE, 0x10, 0x28, 0x44, 0x82,
   0xFE, 0x2, 0x2, 0x2, 0x2,
   0xFE, 0x40, 0x38, 0x40, 0xFE,
   0xFE, 0x20, 0x10, 0x8, 0xFE,
   0x7C, 0x82, 0x82, 0x82, 0x7C,
   0xFE, 0x90, 0x90, 0x90, 0x60,
   0x7C, 0x82, 0x8A, 0x84, 0x7A,
   0xFE, 0x90, 0x98, 0x94, 0x62,
   0x64, 0x92, 0x92, 0x92, 0x4C,
   0xC0, 0x80, 0xFE, 0x80, 0xC0,
   0xFC, 0x2, 0x2, 0x2, 0xFC,
   0xF8, 0x4, 0x2, 0x4, 0xF8,
   0xFC, 0x2, 0x1C, 0x2, 0xFC,
   0xC6, 0x28, 0x10, 0x28, 0xC6,
   0xC0, 0x20, 0x1E, 0x20, 0xC0,
   0x86, 0x9A, 0x92, 0xB2, 0xC2,
   0x0, 0xFE, 0x82, 0x82, 0x82,
   0x40, 0x20, 0x10, 0x8, 0x4,
   0x0, 0x82, 0x82, 0x82, 0xFE,
   0x20, 0x40, 0x80, 0x40, 0x20,
   0x2, 0x2, 0x2, 0x2, 0x2,
   0x0, 0xC0, 0xE0, 0x10, 0x0,
   0x4, 0x2A, 0x2A, 0x1E, 0x2,
   0xFE, 0x14, 0x22, 0x22, 0x1C,
   0x1C, 0x22, 0x22, 0x22, 0x14,
   0x1C, 0x22, 0x22, 0x14, 0xFE,
   0x1C, 0x2A, 0x2A, 0x2A, 0x18,
   0x0, 0x10, 0x7E, 0x90, 0x40,
   0x18, 0x25, 0x25, 0x39, 0x1E,
   0xFE, 0x10, 0x20, 0x20, 0x1E,
   0x0, 0x22, 0xBE, 0x2, 0x0,
   0x4, 0x2, 0x2, 0xBC, 0x0,
   0xFE, 0x8, 0x14, 0x22, 0x0,
   0x0, 0x82, 0xFE, 0x2, 0x0,
   0x3E, 0x20, 0x1E, 0x20, 0x1E,
   0x3E, 0x10, 0x20, 0x20, 0x1E,
   0x1C, 0x22, 0x22, 0x22, 0x1C,
   0x3F, 0x18, 0x24, 0x24, 0x18,
   0x18, 0x24, 0x24, 0x18, 0x3F,
   0x3E, 0x10, 0x20, 0x20, 0x10,
   0x12, 0x2A, 0x2A, 0x2A, 0x24,
   0x20, 0x20, 0xFC, 0x22, 0x24,
   0x3C, 0x2, 0x2, 0x4, 0x3E,
   0x38, 0x4, 0x2, 0x4, 0x38,
   0x3C, 0x2, 0xC, 0x2, 0x3C,
   0x22, 0x14, 0x8, 0x14, 0x22,
   0x32, 0x9, 0x9, 0x9, 0x3E,
   0x22, 0x26, 0x2A, 0x32, 0x22,
   0x0, 0x10, 0x6C, 0x82, 0x0,
   0x0, 0x0, 0xEE, 0x0, 0x0,
   0x0, 0x82, 0x6C, 0x10, 0x0,
   0x40, 0x80, 0x40, 0x20, 0x40,
   0x3C, 0x64, 0xC4, 0x64, 0x3C,
   0x78, 0x85, 0x85, 0x86, 0x48,
   0x5C, 0x2, 0x2, 0x4, 0x5E,
   0x1C, 0x2A, 0x2A, 0xAA, 0x9A,
   0x84, 0xAA, 0xAA, 0x9E, 0x82,
   0x84, 0x2A, 0x2A, 0x1E, 0x82,
   0x84, 0xAA, 0x2A, 0x1E, 0x2,
   0x4, 0x2A, 0xAA, 0x9E, 0x2,
   0x30, 0x78, 0x4A, 0x4E, 0x48,
   0x9C, 0xAA, 0xAA, 0xAA, 0x9A,
   0x9C, 0x2A, 0x2A, 0x2A, 0x9A,
   0x9C, 0xAA, 0x2A, 0x2A, 0x1A,
   0x0, 0x0, 0xA2, 0x3E, 0x82,
   0x0, 0x40, 0xA2, 0xBE, 0x42,
   0x0, 0x80, 0xA2, 0x3E, 0x2,
   0xF, 0x94, 0x24, 0x94, 0xF,
   0xF, 0x14, 0xA4, 0x14, 0xF,
   0x3E, 0x2A, 0xAA, 0xA2, 0x0,
   0x4, 0x2A, 0x2A, 0x3E, 0x2A,
   0x3E, 0x50, 0x90, 0xFE, 0x92,
   0x4C, 0x92, 0x92, 0x92, 0x4C,
   0x4C, 0x12, 0x12, 0x12, 0x4C,
   0x4C, 0x52, 0x12, 0x12, 0xC,
   0x5C, 0x82, 0x82, 0x84, 0x5E,
   0x5C, 0x42, 0x2, 0x4, 0x1E,
   0x0, 0xB9, 0x5, 0x5, 0xBE,
   0x9C, 0x22, 0x22, 0x22, 0x9C,
   0xBC, 0x2, 0x2, 0x2, 0xBC,
   0x3C, 0x24, 0xFF, 0x24, 0x24,
   0x12, 0x7E, 0x92, 0xC2, 0x66,
   0xD4, 0xF4, 0x3F, 0xF4, 0xD4,
   0xFF, 0x90, 0x94, 0x6F, 0x4,
   0x3, 0x11, 0x7E, 0x90, 0xC0,
   0x4, 0x2A, 0x2A, 0x9E, 0x82,
   0x0, 0x0, 0x22, 0xBE, 0x82,
   0xC, 0x12, 0x12, 0x52, 0x4C,
   0x1C, 0x2, 0x2, 0x44, 0x5E,
   0x0, 0x5E, 0x50, 0x50, 0x4E,
   0xBE, 0xB0, 0x98, 0x8C, 0xBE,
   0x64, 0x94, 0x94, 0xF4, 0x14,
   0x64, 0x94, 0x94, 0x94, 0x64,
   0xC, 0x12, 0xB2, 0x2, 0x4,
   0x1C, 0x10, 0x10, 0x10, 0x10,
   0x10, 0x10, 0x10, 0x10, 0x1C,
   0xF4, 0x8, 0x13, 0x35, 0x5D,
   0xF4, 0x8, 0x14, 0x2C, 0x5F,
   0x0, 0x0, 0xDE, 0x0, 0x0,
   0x10, 0x28, 0x54, 0x28, 0x44,
   0x44, 0x28, 0x54, 0x28, 0x10,
   0x55, 0x0, 0xAA, 0x0, 0x55,
   0x55, 0xAA, 0x55, 0xAA, 0x55,
   0xAA, 0x55, 0xAA, 0x55, 0xAA,
   0x0, 0x0, 0x0, 0xFF, 0x0,
   0x8, 0x8, 0x8, 0xFF, 0x0,
   0x28, 0x28, 0x28, 0xFF, 0x0,
   0x8, 0x8, 0xFF, 0x0, 0xFF,
   0x8, 0x8, 0xF, 0x8, 0xF,
   0x28, 0x28, 0x28, 0x3F, 0x0,
   0x28, 0x28, 0xEF, 0x0, 0xFF,
   0x0, 0x0, 0xFF, 0x0, 0xFF,
   0x28, 0x28, 0x2F, 0x20, 0x3F,
   0x28, 0x28, 0xE8, 0x8, 0xF8,
   0x8, 0x8, 0xF8, 0x8, 0xF8,
   0x28, 0x28, 0x28, 0xF8, 0x0,
   0x8, 0x8, 0x8, 0xF, 0x0,
   0x0, 0x0, 0x0, 0xF8, 0x8,
   0x8, 0x8, 0x8, 0xF8, 0x8,
   0x8, 0x8, 0x8, 0xF, 0x8,
   0x0, 0x0, 0x0, 0xFF, 0x8,
   0x8, 0x8, 0x8, 0x8, 0x8,
   0x8, 0x8, 0x8, 0xFF, 0x8,
   0x0, 0x0, 0x0, 0xFF, 0x28,
   0x0, 0x0, 0xFF, 0x0, 0xFF,
   0x0, 0x0, 0xF8, 0x8, 0xE8,
   0x0, 0x0, 0x3F, 0x20, 0x2F,
   0x28, 0x28, 0xE8, 0x8, 0xE8,
   0x28, 0x28, 0x2F, 0x20, 0x2F,
   0x0, 0x0, 0xFF, 0x0, 0xEF,
   0x28, 0x28, 0x28, 0x28, 0x28,
   0x28, 0x28, 0xEF, 0x0, 0xEF,
   0x28, 0x28, 0x28, 0xE8, 0x28,
   0x8, 0x8, 0xF8, 0x8, 0xF8,
   0x28, 0x28, 0x28, 0x2F, 0x28,
   0x8, 0x8, 0xF, 0x8, 0xF,
   0x0, 0x0, 0xF8, 0x8, 0xF8,
   0x0, 0x0, 0x0, 0xF8, 0x28,
   0x0, 0x0, 0x0, 0x3F, 0x28,
   0x0, 0x0, 0xF, 0x8, 0xF,
   0x8, 0x8, 0xFF, 0x8, 0xFF,
   0x28, 0x28, 0x28, 0xFF, 0x28,
   0x8, 0x8, 0x8, 0xF8, 0x0,
   0x0, 0x0, 0x0, 0xF, 0x8,
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
   0xF, 0xF, 0xF, 0xF, 0xF,
   0xFF, 0xFF, 0xFF, 0x0, 0x0,
   0x0, 0x0, 0x0, 0xFF, 0xFF,
   0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
   0x1C, 0x22, 0x22, 0x1C, 0x22,
   0x3E, 0x54, 0x54, 0x7C, 0x28,
   0x7E, 0x40, 0x40, 0x60, 0x60,
   0x40, 0x7E, 0x40, 0x7E, 0x40,
   0xC6, 0xAA, 0x92, 0x82, 0xC6,
   0x1C, 0x22, 0x22, 0x3C, 0x20,
   0x2, 0x7E, 0x4, 0x78, 0x4,
   0x60, 0x40, 0x7E, 0x40, 0x40,
   0x99, 0xA5, 0xE7, 0xA5, 0x99,
   0x38, 0x54, 0x92, 0x54, 0x38,
   0x32, 0x4E, 0x80, 0x4E, 0x32,
   0xC, 0x52, 0xB2, 0xB2, 0xC,
   0xC, 0x12, 0x1E, 0x12, 0xC,
   0x3D, 0x46, 0x5A, 0x62, 0xBC,
   0x7C, 0x92, 0x92, 0x92, 0x0,
   0x7E, 0x80, 0x80, 0x80, 0x7E,
   0x54, 0x54, 0x54, 0x54, 0x54,
   0x22, 0x22, 0xFA, 0x22, 0x22,
   0x2, 0x8A, 0x52, 0x22, 0x2,
   0x2, 0x22, 0x52, 0x8A, 0x2,
   0x0, 0x0, 0xFF, 0x80, 0xC0,
   0x7, 0x1, 0xFF, 0x0, 0x0,
   0x10, 0x10, 0xD6, 0xD6, 0x10,
   0x6C, 0x48, 0x6C, 0x24, 0x6C,
   0x60, 0xF0, 0x90, 0xF0, 0x60,
   0x0, 0x0, 0x18, 0x18, 0x0,
   0x0, 0x0, 0x8, 0x8, 0x0,
   0xC, 0x2, 0xFF, 0x80, 0x80,
   0x0, 0xF8, 0x80, 0x80, 0x78,
   0x0, 0x98, 0xB8, 0xE8, 0x48,
   0x0, 0x3C, 0x3C, 0x3C, 0x3C,};
/*
uint8_t u1601c_buffer[BUFF_SIZE] =
{

0x00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,

0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x00

};*/

#define LOW		0
#define HI 		1
#define TOG		2

#define SDA_PIN_SET		PORT( SDA_PORT ) |= (1<<SDA_PIN)
#define SDA_PIN_RST		PORT( SDA_PORT ) &= ~(1<<SDA_PIN)
#define SDA_PIN_TOG		PORT( SDA_PORT ) ^= (1<<SDA_PIN)

#define SCK_PIN_SET		PORT( SCK_PORT ) |= (1<<SCK_PIN)
#define SCK_PIN_RST		PORT( SCK_PORT ) &= ~(1<<SCK_PIN)
#define SCK_PIN_TOG		PORT( SCK_PORT ) ^= (1<<SCK_PIN)

#define CD_PIN_SET		PORT( CD_PORT ) |= (1<<CD_PIN)
#define CD_PIN_RST		PORT( CD_PORT ) &= ~(1<<CD_PIN)
#define CD_PIN_TOG		PORT( CD_PORT ) ^= (1<<CD_PIN)

#define RST_PIN_SET		PORT( RST_PORT ) |= (1<<RST_PIN)
#define RST_PIN_RST		PORT( RST_PORT ) &= ~(1<<RST_PIN)
#define RST_PIN_TOG		PORT( RST_PORT ) ^= (1<<RST_PIN)

#define CS0_PIN_SET		PORT( CS0_PORT ) |= (1<<CS0_PIN)
#define CS0_PIN_RST		PORT( CS0_PORT ) &= ~(1<<CS0_PIN)
#define CS0_PIN_TOG		PORT( CS0_PORT ) ^= (1<<CS0_PIN)

#define LIGHT_PIN_SET	PORT( LIGHT_PORT ) |= (1<<LIGHT_PIN)
#define LIGHT_PIN_RST	PORT( LIGHT_PORT ) &= ~(1<<LIGHT_PIN)
#define LIGHT_PIN_TOG	PORT( LIGHT_PORT ) ^= (1<<LIGHT_PIN)


void uc1601_sda_pin_set_as_output(void){DDR( SDA_PORT ) |= (1<<SDA_PIN);}
void uc1601_sda_pin_set_hi(void){PORT( SDA_PORT ) |= (1<<SDA_PIN);}
void uc1601_sda_pin_set_low(void){PORT( SDA_PORT ) &= ~(1<<SDA_PIN);}
void uc1601_sda_pin_set_tog(void){PORT( SDA_PORT ) ^= (1<<SDA_PIN);}

void uc1601_sck_pin_set_as_output(void){DDR( SCK_PORT ) |= (1<<SCK_PIN);}
void uc1601_sck_pin_set_hi(void){PORT( SCK_PORT ) |= (1<<SCK_PIN);}
void uc1601_sck_pin_set_low(void){PORT( SCK_PORT ) &= ~(1<<SCK_PIN);}
void uc1601_sck_pin_set_tog(void){PORT( SCK_PORT ) ^= (1<<SCK_PIN);}

void uc1601_cd_pin_set_as_output(void){DDR( CD_PORT ) |= (1<<CD_PIN);}
void uc1601_cd_pin_set_hi(void){PORT( CD_PORT ) |= (1<<CD_PIN);}
void uc1601_cd_pin_set_low(void){PORT( CD_PORT ) &= ~(1<<CD_PIN);}
void uc1601_cd_pin_set_tog(void){PORT( CD_PORT ) ^= (1<<CD_PIN);}

void uc1601_rst_pin_set_as_output(void){DDR( RST_PORT ) |= (1<<RST_PIN);}
void uc1601_rst_pin_set_hi(void){PORT( RST_PORT ) |= (1<<RST_PIN);}
void uc1601_rst_pin_set_low(void){PORT( RST_PORT ) &= ~(1<<RST_PIN);}
void uc1601_rst_pin_set_tog(void){PORT( RST_PORT ) ^= (1<<RST_PIN);}

void uc1601_cs0_pin_set_as_output(void){DDR( CS0_PORT ) |= (1<<CS0_PIN);}
void uc1601_cs0_pin_set_hi(void){PORT( CS0_PORT ) |= (1<<CS0_PIN);}
void uc1601_cs0_pin_set_low(void){PORT( CS0_PORT ) &= ~(1<<CS0_PIN);}
void uc1601_cs0_pin_set_tog(void){PORT( CS0_PORT ) ^= (1<<CS0_PIN);}

void uc1601_light_pin_set_as_output(void){DDR( LIGHT_PORT ) |= (1<<LIGHT_PIN);}
void uc1601_light_pin_set_hi(void){PORT( LIGHT_PORT ) |= (1<<LIGHT_PIN);}
void uc1601_light_pin_set_low(void){PORT( LIGHT_PORT ) &= ~(1<<LIGHT_PIN);}
void uc1601_light_pin_set_tog(void){PORT( LIGHT_PORT ) ^= (1<<LIGHT_PIN);}

uint8_t uc1601_send_byte(uint8_t byte)
{
	uc1601_sck_pin_set_low();
	uc1601_sda_pin_set_low();
	uint8_t i=0x80;
	while(i){
		if(byte&i)uc1601_sda_pin_set_hi();
		else uc1601_sda_pin_set_low();
		uc1601_sck_pin_set_hi();
		uc1601_sck_pin_set_low();
		i>>=1;
	}

	uc1601_sck_pin_set_low();
	uc1601_sda_pin_set_hi();

	return TRUE;
}
uint8_t uc1601_send_command(uint8_t byte)
{
	uc1601_cd_pin_set_low();
	if(uc1601_send_byte(byte)==FALSE)return FALSE;
	return TRUE;
}

uint8_t uc1601_send_data(uint8_t byte)
{
	uc1601_cd_pin_set_hi();
	if(uc1601_send_byte(byte)==FALSE)return FALSE;
	return TRUE;
}
uint8_t uc1601_init(void)
{

	// set up pin as output
	uc1601_sda_pin_set_as_output();
	uc1601_sck_pin_set_as_output();
	uc1601_cd_pin_set_as_output();
	uc1601_rst_pin_set_as_output();
	uc1601_cs0_pin_set_as_output();
	uc1601_light_pin_set_as_output();

	// RST SET HI

	uc1601_cs0_pin_set_low();
	uc1601_rst_pin_set_low();
	_delay_ms(500);
	uc1601_rst_pin_set_hi();

	uc1601_sda_pin_set_hi();
	uc1601_cd_pin_set_low();
	uc1601_cd_pin_set_hi();


	uc1601_send_command(CMD_DISPLAY_ON);
	uc1601_clear_all();


	uc1601_light(TRUE);
	_delay_ms(10);
	return TRUE;

}

uint8_t uc1601_send_buff_to_display(uint8_t * buff)
{

	// sent page 0
	uc1601_send_command(CMD_SET_PAGE | 0x03);
  	uc1601_send_command(CMD_SET_COLUMN_LOWER | (0x00 & 0xf));
  	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((0x00 >> 4) & 0xf));
	for(uint8_t i=0; i<LCDWIDTH;i++)
	{
		uc1601_send_data(*buff++);
	}

	// sent page 1
	uc1601_send_command(CMD_SET_PAGE | 0x02);
  	uc1601_send_command(CMD_SET_COLUMN_LOWER | (0x00 & 0xf));
  	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((0x00 >> 4) & 0xf));
	for(uint8_t i=0; i<LCDWIDTH;i++)
	{
		uc1601_send_data(*buff++);
	}

	// sent page 2
	uc1601_send_command(CMD_SET_PAGE | 0x01);
	uc1601_send_command(CMD_SET_COLUMN_LOWER | (0x00 & 0xf));
	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((0x00 >> 4) & 0xf));
	for(uint8_t i=0; i<LCDWIDTH;i++)
	{
		uc1601_send_data(*buff++);
	}

	// sent page 3
	uc1601_send_command(CMD_SET_PAGE | 0x00);
	uc1601_send_command(CMD_SET_COLUMN_LOWER | (0x00 & 0xf));
	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((0x00 >> 4) & 0xf));
	for(uint8_t i=0; i<LCDWIDTH;i++)
	{
		uc1601_send_data(*buff++);
	}
	return TRUE;

}


uint8_t uc1601_clear_buff(void)
{
	for (uint16_t i=0;i<BUFF_SIZE;i++)u1601c_buffer[i]=0x00;
	return TRUE;
}
uint8_t uc1601_clear_all(void)
{
	uc1601_clear_buff();
	uc1601_clear_display();
	return TRUE;
}


uint8_t  uc1601_drawchar(uint8_t x, uint8_t line, char c)
{
	for (uint8_t i =0; i<5; i++ )
	{
		u1601c_buffer[x + (line*LCDWIDTH) ] = pgm_read_byte(font+(c*5)+i);
		x++;
	}
  return TRUE;
}

uint8_t uc1601_drawchar2(uint8_t x, uint8_t line, char c)
{
	if((LCDWIDTH<x)||(LCD_LINES-1<line)||(!c))return FALSE;


	uc1601_send_command(CMD_SET_PAGE | line);
  	uc1601_send_command(CMD_SET_COLUMN_LOWER | (x & 0xf));
  	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((x >> 4) & 0xf));
	for (uint8_t i=0;i<5;i++)
	{
			uc1601_send_data(pgm_read_byte(font+(c*5)+i));
	}
	return TRUE;
}

uint8_t uc1601_drawstring_P(uint8_t x, uint8_t line,  const char  *str)
{
	register char c;
	while (1)
	{
		c = (pgm_read_byte(str++));
		if (c)
		uc1601_drawchar(x, line, c);
		else return TRUE;
		x += 6; // 6 pixels wide
		if (x + 6 >= LCDWIDTH)
		{
			x = 0;    // ran out of this line
			line++;
		}

	}

}

uint8_t uc1601_drawstring2_P(uint8_t x, uint8_t line,  const char  *str)
{
	register char c;
	while (1)
	{
		c = (pgm_read_byte(str++));
		if (c)
			uc1601_drawchar2(x, line, c);
		else return TRUE;
		x += 6; // 6 pixels wide
		if (x + 6 >= LCDWIDTH)
		{
			x = 0;    // ran out of this line
			line++;
		}

	}

}
uint8_t uc1601_drawstring2(uint8_t x, uint8_t line, char  *str)
{
	register char c;
	while (1)
	{
		c = *str++;
		if (c)
			uc1601_drawchar2(x, line, c);
		else return TRUE;
		x += 6; // 6 pixels wide
		if (x + 6 >= LCDWIDTH)
		{
			x = 0;    // ran out of this line
			line++;
		}
	}

}
uint8_t uc1601_drawstring(uint8_t x, uint8_t line, char  *str)
{
	register char c;
	while (1)
	{
		c = *str++;
		if (c)
		uc1601_drawchar(x, line, c);
		else return TRUE;
		x += 6; // 6 pixels wide
		if (x + 6 >= LCDWIDTH)
		{
			x = 0;    // ran out of this line
			line++;
		}
	}

}

uint8_t uc1601_drawint(uint8_t x, uint8_t line,int value, int radix)	// wysy³a na port szeregowy tekst
{

	char string[17];			// bufor na wynik funkcji itoa
	itoa(value, string, radix);		// konwersja value na ASCII
	uc1601_drawstring(x,line,string);			// wyœlij string na port szeregowy
	return TRUE;
}
uint8_t uc1601_drawint2(uint8_t x, uint8_t line,int value, int radix)
{
	char string[17];							// bufor na wynik funkcji itoa
	itoa(value, string, radix);					// konwersja value na ASCII
	uc1601_drawstring2(x,line,string);			// wyœlij string na port szeregowy
	return TRUE;
}
void uc1601_setpixel(uint8_t x, uint8_t y, uint8_t color) {

  // x is which column
  if (color)
	  u1601c_buffer[x+ (y/8)*LCDWIDTH] |= (1<<(7-(y%8)));
  else
	  u1601c_buffer[x+ (y/8)*LCDWIDTH] &= ~(1<<(7-(y%8)));	//(1<<(bit))
}

uint8_t uc1601_clear_display(void)
{
	  uint8_t p, c;
	  for(p = 0; p < 8; p++) {
	    uc1601_send_command(CMD_SET_PAGE | p);
	    for(c = 0; c < 129; c++) {
	    	uc1601_send_command(CMD_SET_COLUMN_LOWER | (c & 0xf));
	    	uc1601_send_command(CMD_SET_COLUMN_UPPER | ((c >> 4) & 0xf));
	    	uc1601_send_data(0x00);
	    }
	  }
	return TRUE;
}
void uc1601_light(uint8_t state)
{
	if(state)uc1601_light_pin_set_low();	// light ON
	else uc1601_light_pin_set_hi();	// light OFF

}
void uc1601_reset(void)
{
	uc1601_rst_pin_set_low();
	_delay_ms(20);
	uc1601_rst_pin_set_hi();
}
